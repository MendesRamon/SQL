
--MÉDIA MODA NO SQL

WITH sb9010_ AS (
	SELECT 
		B9_COD,
		B9_DATA,
		ROUND(B9_CM1,2) AS B9_CM1
	FROM sb9010
--	WHERE B9_DATA = '20230630'
)

SELECT
	B9_COD,
	B9_DATA,
	B9_CM1
FROM (
	--CONSULTA
	SELECT
		B9_COD,
		B9_DATA,
		B9_CM1,
		--COLUNA VIRTUAL

			ROW_NUMBER() OVER (
		
				PARTITION BY
					B9_COD, B9_DATA 
				ORDER BY 
					COUNT(*) DESC, 
					B9_CM1 ASC
		
			) AS INDICE

	FROM sb9010_

	GROUP BY
		B9_COD,
		B9_DATA,
		B9_CM1

) AS SUBQUERY

WHERE 
	SUBQUERY.INDICE = 1